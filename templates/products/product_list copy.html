{% extends 'admin_base.html' %}
{% block body_block %}
{% load static %}

<!-- FontAwesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<div class="container mt-4">

  <!-- HEADER -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <h2 class="text-primary">Product List</h2>

    <div class="d-flex gap-2">
      <a href="{% url 'update_all_products' %}" class="btn btn-primary">
        <i class="fa fa-upload"></i> Upload Products
      </a>
      <a href="{% url 'product_create' %}" class="btn btn-success">
        <i class="fa fa-plus"></i> Create Product
      </a>
    </div>
  </div>

  <!-- ðŸ” SMART COMMON SEARCH -->
  <form method="get" class="mb-3">
    <div class="input-group">
      <input
        type="text"
        name="q"
        class="form-control"
        placeholder="Search product (e.g. gliclazide 30 + metformin)"
        value="{{ request.GET.q }}"
        autocomplete="off"
      >
      <button class="btn btn-primary">
        <i class="fa fa-search"></i>
      </button>
    </div>
  </form>

  <!-- PRODUCT TABLE -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered text-center align-middle">
      <thead>
        <tr>
          <th class="bg-primary text-white">Product ID</th>
          <th class="bg-primary text-white">Product Name</th>
          <th class="bg-primary text-white">Composition</th>
          <th class="bg-primary text-white">Type</th>
          <th class="bg-primary text-white">Price</th>
          <th class="bg-primary text-white">Pack Size</th>
          <th class="bg-primary text-white">GST</th>
          <th class="bg-primary text-white">Quantity</th>
          <th class="bg-primary text-white">Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for product in products %}
        <tr>
          <td>{{ product.product_id }}</td>
          <td style="white-space: normal; word-break: break-word;">
            {{ product.name }}
          </td>
          <td style="white-space: normal; word-break: break-word;">
            {{ product.composition_name }}
          </td>
          <td>{{ product.product_type }}</td>
          <td>{{ product.price }}</td>
          <td>{{ product.pack_size }}</td>
          <td>{{ product.GST }}</td>
          <td>{{ product.quantity }}</td>
          <td>
            <a href="{% url 'product_update' product.id %}"
               class="btn btn-sm btn-primary">
              <i class="fa fa-edit"></i>
            </a>
            <a href="{% url 'product_delete' product.id %}"
               class="btn btn-sm btn-danger">
              <i class="fa fa-trash"></i>
            </a>
            <a href="{% url 'product_markups' product.id %}"
               class="btn btn-sm btn-secondary">
              <i class="fa fa-percent"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="9" class="text-center text-muted">
            No products found
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
